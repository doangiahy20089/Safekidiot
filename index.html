<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeKid IoT - Theo d√µi An to√†n Tr·∫ª em</title>
   <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

   
    <!-- MQTT over WebSocket -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <style>
      
        /* (Gi·ªØ nguy√™n to√†n b·ªô CSS g·ªëc c·ªßa b·∫°n) */
        * {
            margin: 0;
            padding: 0;
@@ -497,7 +498,7 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>

        <div class="main-content">
            <div class="sidebar">
              
                <!-- Th·ªëng k√™ -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-chart-bar"></i>
@@ -515,6 +516,7 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
                    </div>
                </div>

                <!-- Th√™m thi·∫øt b·ªã -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-plus-circle"></i>
@@ -543,7 +545,7 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
                    </button>
                </div>

                
                <!-- Danh s√°ch thi·∫øt b·ªã -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-list"></i>
@@ -556,7 +558,7 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
                    </div>
                </div>

              
                <!-- ƒêi·ªÅu khi·ªÉn -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-location-arrow"></i>
@@ -573,7 +575,7 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
                    </button>
                </div>

               
                <!-- MQTT Connect Controls -->
                <div class="section">
                    <div class="section-title">
                        <i class="fas fa-plug"></i>
@@ -625,7 +627,7 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
                </div>
            </div>

           
            <!-- Chat Box -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-title">
@@ -655,17 +657,11 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
    </div>

    <script>
<<<<<<< HEAD
        
        // ---------------------------
        // Map init (gi·ªØ nguy√™n)
        // ---------------------------
        var map = L.map('map').setView([10.9453, 106.8243], 13);

=======
        // Kh·ªüi t·∫°o b·∫£n ƒë·ªì
       // var map = L.map('map').setView([10.7769, 106.7009], 13); // TP.HCM
       // var map = L.map('map').setView([11.0, 107.1], 9); //To√†n t·ªânh ƒê·ªìng Nai
          var map = L.map('map').setView([10.9453, 106.8243], 13); //c·ª•c b·ªô ƒê·ªìng Nai
        // L·ªõp b·∫£n ƒë·ªì
>>>>>>> cffac85127651d1b946befc16b1e907f5cf289d5
        var streetMap = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '¬© OpenStreetMap contributors'
@@ -679,14 +675,8 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
        streetMap.addTo(map);
        var isStreetMap = true;

<<<<<<< HEAD
      
        var homePoint = [10.933750236765478, 106.8312536793566];
=======
        // ƒêi·ªÉm xu·∫•t ph√°t (nh√†/tr∆∞·ªùng)
            //var homePoint = [10.7769, 106.7009];
        var homePoint = [10.933750236765478, 106.8312536793566]; //g·ªëc t·ªça ƒë·ªô tr∆∞·ªùng Nam H√†
>>>>>>> cffac85127651d1b946befc16b1e907f5cf289d5
        var homePoint = [10.933750236765478, 106.8312536793566];
        var homeIcon = L.divIcon({
            className: 'custom-div-icon',
            html: '<i class="fas fa-home" style="color: #e53e3e; font-size: 20px;"></i>',
@@ -695,21 +685,27 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
        });
        L.marker(homePoint, { icon: homeIcon }).addTo(map).bindPopup("<b>üè† ƒêi·ªÉm xu·∫•t ph√°t</b><br>Nh√†/Tr∆∞·ªùng h·ªçc");

       
        // ---------------------------
        // Data structures
        // ---------------------------
        // devices array kept for UI compatibility, but we'll also keep maps:
        var devices = []; // {sim,name,lat,lng,...}
        var markers = {}; // sim -> L.marker
        var polylines = {}; // sim -> L.polyline
        var paths = {}; // sim -> Array of [lat,lng]
        var selectedDevice = null;

      
        // child icon
        var childIcon = L.divIcon({
            className: 'custom-div-icon',
            html: '<i class="fas fa-child" style="color: #48bb78; font-size: 16px;"></i>',
            iconSize: [25, 25],
            iconAnchor: [12, 12]
        });

        // ---------------------------
        // Helper functions (UI)
        // ---------------------------
        function showAlert(message, type) {
            type = type || 'error';
            var alert = document.getElementById('alert');
@@ -1117,7 +1113,9 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
        }

        // ---------------------------
        
        // Init: prefill MQTT fields if you want (example values)
        // ---------------------------
        // N·∫øu b·∫°n mu·ªën t·ª± ƒë·ªông ƒëi·ªÅn host/user t·ª´ l·∫ßn tr∆∞·ªõc, ƒë·∫∑t ·ªü ƒë√¢y:
        document.getElementById('mqttHost').value = 'c53d20bafaec4b96a4f29ffa91cb7eb0.s1.eu.hivemq.cloud'; // example from your screenshot
        document.getElementById('mqttUser').value = 'doangiahy12';
        // document.getElementById('mqttPass').value = '...'; // ƒëi·ªÅn m·∫≠t kh·∫©u ·ªü ƒë√¢y n·∫øu mu·ªën
@@ -1144,9 +1142,15 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
            updateStats();
        };

      
        // ---------------------------
        // Load previously saved devices? (not implemented: placeholder)
        // ---------------------------

        // ---------------------------
        // Basic simulate function (dev)
        // ---------------------------
        window.simulatePublish = function (sim) {
           
            // push a message through MQTT client (useful for testing)
            var s = sim || 'SIM_TEST_01';
            var latlng = randomLatLng();
            var payload = JSON.stringify({ sim: s, name: 'B√© ' + s.slice(-3), lat: latlng[0], lng: latlng[1], ts: (new Date()).toISOString() });
@@ -1155,13 +1159,13 @@ <h1><i class="fas fa-shield-alt"></i> SafeKid IoT</h1>
                mqttClient.publish('safekid/' + s + '/location', payload);
                addMessageToChat('H·ªá th·ªëng', 'MQTT', 'ƒê√£ g·ª≠i th·ª≠ payload t·ªõi topic safekid/' + s + '/location', 'info');
            } else {
               
                // simulate locally without broker
                handleLocationMessage(s, 'B√© ' + s.slice(-3), latlng[0], latlng[1]);
                addMessageToChat('H·ªá th·ªëng', 'SIM', 'ƒê√£ m√¥ ph·ªèng v·ªã tr√≠ (offline)', 'info');
            }
        };

               
            // End of script
    </script>
</body>
</html>
